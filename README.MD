---

# Organic Synapse Fingerprint Recognition (物理感知指纹识别系统)

本项目基于 PyTorch 框架，实现了一个面向**有机神经形态计算（Organic Neuromorphic Computing）**的硬件感知指纹识别系统。

该项目的核心目标不仅仅是追求高识别率，而是**模拟真实物理器件（有机忆阻器/突触）的非理想特性**，并通过特殊的训练策略（动态噪声注入、LTP/LTD 非线性映射、周期性校准）来训练出能够稳定部署在不完美硬件上的鲁棒模型。

---

## 1. 数据集 (Dataset)

* **来源**：NIST Special Database 4 (NIST-SD4) 或同类指纹数据集。
* **规模**：包含约 4000 张指纹图像。
* **类别**：5 类 (Arch, Left Loop, Right Loop, Tented Arch, Whorl)。
* **结构**：
```text
Dataset5/
├── train/  (按类别分文件夹)
└── test/   (按类别分文件夹)

```



### 数据预处理与增强 (Data Processing)

为了提升模型在物理噪声下的泛化能力，我们采用了激进的数据增强策略：

1. **物理裁切**：`CropBottom(32)` —— 去除指纹传感器底部的无关白边/噪点区域。
2. **几何变换**：
* **随机旋转**：`RandomRotation(30)` (+/- 30度)。
* **随机仿射**：`RandomAffine` (平移、剪切)，模拟手指按压时的不同姿态。


3. **Mixup (混合增强)**：
* 在训练过程中，以一定比例 (Lambda) 混合两张指纹图片及其标签：
```python
x_mix = lambda * x_i + (1 - lambda) * x_j
y_mix = lambda * y_i + (1 - lambda) * y_j

```


* **目的**：强迫模型学习指纹的纹理结构特征，而非死记硬背图像轮廓，显著防止过拟合。



---

## 2. 模型架构 (Model Architecture)

* **基骨干网**：`ResNet-18` (针对 5 分类任务修改了全连接层)。
* **算子融合 (Operator Fusion)**：
* 我们使用自定义算子 `OrganicSynapseConv` 替换了所有标准的 `nn.Conv2d` 层。
* 该算子实现了从**数学域**（权重 W 在 [-1, 1]）到**物理电导域**（G 在 [G_min, G_max]）的双向映射。



### 核心物理映射机制

在前向传播中，权重不再是理想的浮点数，而是模拟了物理器件的行为：

1. **映射 (Mapping)**：将标准化权重线性映射到物理电导区间。
2. **噪声注入 (Device Noise)**：`G_noisy = G + Noise` (高斯白噪声)。
3. **读出 (Readout)**：将加噪后的物理电导重新映射回数学域用于卷积计算。

---

## 3. 硬件感知训练策略 (Hardware-Aware Training)

这是本项目的核心创新点，旨在解决模拟存内计算的“器件非理想性”问题。

### 3.1 LTP/LTD 非线性梯度修正

真实器件的电导更新是非线性的（长时程增强/抑制不对称）。我们拟合了真实器件的测量数据，得到多项式曲线。
在反向传播更新权重时，我们修改梯度：

```text
g_new = g_old * (1 - alpha) + (g_old * Slope(W)) * alpha

```

其中 `Slope(W)` 根据当前权重值查询 LTP/LTD 曲线的斜率。这迫使模型避开器件的饱和区，学习适应器件的物理特性。

### 3.2 动态噪声注入 (Dynamic Noise Injection)

为了训练出抗噪模型，我们在训练过程中动态调整噪声强度 Sigma：

* **阶段 1 (特种兵训练)**：噪声强度在 0.5倍 到 2.5倍 标准差之间随机波动。让模型在剧烈波动的噪声中学习鲁棒特征。
* **阶段 2 (退火微调)**：噪声强度限制在 0.5倍 到 1.0倍。在训练末期降低噪声上限，恢复模型的精细识别能力。

### 3.3 周期性校准 (Periodic Calibration)

模拟芯片的“刷新/重写”机制。每隔 20 个 Epoch，我们暂停噪声注入和非线性修正，进行 2 个 Epoch 的纯数字域微调。

* **效果**：在 Loss 曲线中形成锯齿状“心跳”，防止模型在噪声中迷失方向，显著提升了最终收敛精度。

### 3.4 优化器与调度

* **优化器**：`AdamW` (Weight Decay 修正版 Adam)。
* **学习率调度**：`CosineAnnealingLR` (带 Warmup)。学习率随 Epoch 按余弦曲线下降，配合周期性校准效果极佳。

---

## 4. 实验结果与可视化 (Visualization)

训练脚本会自动生成以下图表，用于评估模型性能和物理适应性：

### 4.1 权重分布对比 (`weight_contrast.png`)

* **内容**：展示 `conv1` 层在训练前（随机初始化）和训练后（物理适应后）的权重直方图与热力图。
* **怎么看**：
* **直方图**：训练后的权重分布通常不再是标准高斯分布，而是呈现出适应 LTP/LTD 曲线的特殊形态（如双峰或截断）。
* **热力图**：如果训练后的卷积核显示出清晰的纹理（类似 Gabor 滤波器），说明模型在噪声干扰下依然学到了有效的视觉特征。



### 4.2 鲁棒性扫描曲线 (`robustness_scan_data.txt` / Console Log)

* **内容**：在推理阶段人为施加不同倍率的噪声 (0.5x 到 2.0x)，测试准确率的变化。
* **怎么看**：
* **Baseline**：在 1.5x 噪声下通常会崩盘 (<30%)。
* **Ours**：曲线应保持平缓，在 1.5x 噪声下仍能保持较高可用性 (>70%)。



### 4.3 训练曲线 (`curves.png`)

* 展示 Train/Test 的 Loss 和 Accuracy。
* **特征**：你会看到 Loss 曲线呈现明显的**锯齿状**，每一次“下探”都对应一次周期性校准，这是硬件感知训练的标志性特征。

---

## 5. 快速开始 (Usage)

### 环境要求

* Python 3.8+
* PyTorch 2.0+ (推荐 2.4+ 以支持 `torch.compile`)
* NVIDIA GPU (支持 AMP 加速)

### 运行消融实验

使用提供的自动化脚本一键运行三组对比实验：

```bash
python run_ablation.py

```

该脚本将依次执行：

1. **Exp1 (Baseline)**: 无任何物理优化。
2. **Exp2 (Algo)**: 仅含 Mixup + 校准。
3. **Exp3 (Full)**: 全量方案 (含动态噪声)，性能最强。

实验结果将保存在 `logs/` 目录下。

---

## 6. 结论 (Conclusion)

本项目证明了，通过引入**动态噪声注入**和**周期性校准**，我们可以在不牺牲太多理想精度的情况下，将模型在极端物理噪声下的生存能力提升 **2倍以上**。这为未来将神经网络部署到低功耗、不完美的有机忆阻器芯片上提供了可行的软件解决方案。

---